#include <stdio.h>
#include <signal.h>
#include <unistd.h>
#include <stdlib.h>

void handle(int signal);

int main(){
 
  char stringa_tmp[200];
  pid_t consumatore, produttore;
  int file;

  setbuf(stdout,NULL);

  signal(SIGUSR1, handle);
  signal(SIGUSR2, handle);

  file=open(./file_passaggio_dati,RDWR);

  if((produttore=fork())){
    if((consumatore=fork()))
      {
	fprintf(file,"%d",consumatore);
      }
    else{
      while(1){
	pause();
	fgets(stringa_tmp);
	l=strlen(stringa_tmp);
	for(i=0; i<l; i++) toupper(stringa_tmp[i]);
	printf("%s\n",stringa_tmp);
	sleep(1);
	kill(produttore, SIGUSR1);
      }
    }
  }else
    { while(1){
	fscanf(file,"%d",&consumatore)
	gets(stringa_tmp);
	fprintf(file,"%s",stringa_tmp);
	sleep(1);
	kill(consumatore, SIGUSR2);
	pause();
      }
    }
  wait();
  wait();
  close(file);

  return 0;
}

void handle(int signal){
  if(signal==SIGUSR1){printf("Catturato segnale USR1\n");
  }
  else
    if(signal==SIGUSR2){ printf("Catturato segnale USR2\n");
    }
    else printf("Catturato segnale non valido\n");
  return;
}
